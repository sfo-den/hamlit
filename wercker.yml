box: wercker/rvm
build:
  steps:
    - rvm-use:
        version: 2.2.3
    - script:
        name: update bundler
        code: gem update bundler

    - bundle-install

    - script:
        name: clone hamlit1
        code: bin/clone
    - script:
        name: test all
        code: bundle exec rake test
    - script:
        name: Hamlit::AttributeBuilder.build_data micro benchmark
        code: benchmark/ext/build_data.rb
    - script:
        name: "[benchmark] static attributes"
        code: bin/bench bench -t benchmark/boolean_attribute.haml benchmark/class_attribute.haml benchmark/id_attribute.haml benchmark/data_attribute.haml benchmark/common_attribute.haml
    - script:
        name: "[benchmark] dynamic attributes"
        code: bin/bench bench -t benchmark/dynamic_attributes/boolean_attribute.haml benchmark/dynamic_attributes/class_attribute.haml benchmark/dynamic_attributes/id_attribute.haml benchmark/dynamic_attributes/data_attribute.haml benchmark/dynamic_attributes/common_attribute.haml
    - script:
        name: "[benchmark] attribute_builder bench by faml"
        code: bin/bench bench -t benchmark/etc/attribute_builder.haml

    - rvm-use:
        version: 2.1.7
    - script:
        name: update bundler
        code: gem update bundler
    - bundle-install
    - script:
        name: test all
        code: bundle exec rake test

    - rvm-use:
        version: 2.0.0
    - script:
        name: update bundler
        code: gem update bundler
    - bundle-install
    - script:
        name: test all
        code: bundle exec rake test
