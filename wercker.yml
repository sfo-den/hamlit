box: wercker/rvm
build:
  steps:
    - rvm-use:
        version: 2.2.3
    - script:
        name: update bundler
        code: gem update bundler

    - bundle-install

    - script:
        name: test all
        code: bundle exec rake test
    - script:
        name: "[benchmark] static attributes"
        code: TEMPLATE=benchmark/boolean_attribute.haml,benchmark/class_attribute.haml,benchmark/id_attribute.haml,benchmark/data_attribute.haml,benchmark/common_attribute.haml bundle exec rake bench
    - script:
        name: "[benchmark] dynamic attributes"
        code: TEMPLATE=benchmark/dynamic_attributes/boolean_attribute.haml,benchmark/dynamic_attributes/class_attribute.haml,benchmark/dynamic_attributes/id_attribute.haml,benchmark/dynamic_attributes/data_attribute.haml,benchmark/dynamic_attributes/common_attribute.haml bundle exec rake bench
    - script:
        name: "[benchmark] attribute_builder bench by faml"
        code: TEMPLATE=benchmark/etc/attribute_builder.haml bundle exec rake bench
    - script:
        name: "[benchmark] benchmark by slim"
        code: SLIM_BENCH=1 bundle exec rake bench
    - script:
        name: "[benchmark] compilation of haml's standard.haml"
        code: TEMPLATE=test/haml/templates/standard.haml COMPILE=1 bundle exec rake bench

    - rvm-use:
        version: 2.1.7
    - script:
        name: update bundler
        code: gem update bundler
    - bundle-install
    - script:
        name: test all
        code: bundle exec rake test

    - rvm-use:
        version: 2.0.0
    - script:
        name: update bundler
        code: gem update bundler
    - bundle-install
    - script:
        name: test all
        code: bundle exec rake test
